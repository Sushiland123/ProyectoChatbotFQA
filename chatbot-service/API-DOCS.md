# 📚 Documentación API - Chatbot Service\n\n## 🚀 **Acceso a la Documentación**\n\n### 📖 **Swagger UI (Interactiva)**\n```\nhttp://localhost:3003/api/docs\n```\n\n### 🔗 **Endpoint de la API**\n```\nhttp://localhost:3003\n```\n\n## 🎯 **Endpoints Principales**\n\n### 🤖 **Chat**\n\n#### **POST /chat/message**\n- **Descripción**: Endpoint principal para enviar mensajes al chatbot\n- **Autenticación**: No requerida\n- **Headers opcionales**:\n  - `x-user-id`: ID del usuario para contexto\n\n**Ejemplo de petición:**\n```json\n{\n  \"message\": \"¿Cuáles son sus horarios de atención?\",\n  \"sessionId\": \"user-session-123\"\n}\n```\n\n**Ejemplo de respuesta:**\n```json\n{\n  \"message\": \"Nuestros horarios son de lunes a viernes de 8:00 AM a 6:00 PM\",\n  \"sessionId\": \"user-session-123\",\n  \"origen\": \"DIALOGFLOW\",\n  \"escalado\": false,\n  \"timestamp\": \"2024-01-15T10:30:00Z\"\n}\n```\n\n#### **GET /chat** (Legacy)\n- **Descripción**: Endpoint de compatibilidad con versiones anteriores\n- **Parámetros**:\n  - `q`: Mensaje del usuario\n  - `session`: ID de sesión (opcional)\n\n**Ejemplo:**\n```\nGET /chat?q=¿Cuáles son sus horarios?&session=user-123\n```\n\n### 📊 **Analytics**\n\n#### **GET /analytics**\n- **Descripción**: Obtener métricas y estadísticas del chatbot\n- **Headers opcionales**:\n  - `x-user-id`: Filtrar por usuario específico\n\n**Ejemplo de respuesta:**\n```json\n{\n  \"interacciones\": {\n    \"total\": 1250,\n    \"hoy\": 45,\n    \"semana\": 312,\n    \"mes\": 1250\n  },\n  \"origen\": {\n    \"dialogflow\": 875,\n    \"ia\": 375\n  },\n  \"escalamiento\": {\n    \"total\": 25,\n    \"porcentaje\": 2.0\n  },\n  \"sesionesUnicas\": 450,\n  \"tiempoPromedioRespuesta\": 245\n}\n```\n\n## 🔄 **Flujo de Conversación**\n\n### 1. **Consulta Simple**\n```\n👤 Usuario: \"¿Cuáles son sus horarios?\"\n🤖 Dialogflow: \"Nuestros horarios son de 8 AM a 6 PM\"\n✅ Origen: DIALOGFLOW\n```\n\n### 2. **Consulta Compleja (Fallback a IA)**\n```\n👤 Usuario: \"Explícame sobre inteligencia artificial\"\n❌ Dialogflow: No entiende\n🤖 OpenAI: \"La inteligencia artificial es...\"\n✅ Origen: IA\n```\n\n### 3. **Escalamiento a Soporte**\n```\n👤 Usuario: \"no entiendo, esto no me ayuda\"\n🤖 Sistema: \"¿Desea escalar a soporte? Envíe DUI y correo\"\n👤 Usuario: \"12345678-9 user@email.com\"\n🤖 Sistema: \"✅ Ticket #123 creado\"\n✅ Escalado: true\n```\n\n## 🔧 **Códigos de Estado HTTP**\n\n| Código | Descripción | Casos |\n|--------|-------------|-------|\n| **200** | OK | GET /chat, GET /analytics |\n| **201** | Created | POST /chat/message |\n| **400** | Bad Request | Mensaje vacío, formato inválido |\n| **500** | Internal Error | Error en servicios externos |\n\n## 📝 **Ejemplos de Uso**\n\n### **cURL**\n\n```bash\n# Enviar mensaje simple\ncurl -X POST http://localhost:3003/chat/message \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"message\": \"¿Cuáles son sus horarios?\",\n    \"sessionId\": \"test-session\"\n  }'\n\n# Obtener analytics\ncurl -X GET http://localhost:3003/analytics \\\n  -H \"x-user-id: user-123\"\n```\n\n### **JavaScript/Fetch**\n\n```javascript\n// Enviar mensaje\nconst response = await fetch('http://localhost:3003/chat/message', {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/json',\n    'x-user-id': 'user-123'\n  },\n  body: JSON.stringify({\n    message: '¿Cuáles son sus horarios?',\n    sessionId: 'user-session-123'\n  })\n});\n\nconst data = await response.json();\nconsole.log(data);\n\n// Obtener analytics\nconst analytics = await fetch('http://localhost:3003/analytics', {\n  headers: {\n    'x-user-id': 'user-123'\n  }\n});\n\nconst metrics = await analytics.json();\nconsole.log(metrics);\n```\n\n### **Python/Requests**\n\n```python\nimport requests\n\n# Enviar mensaje\nresponse = requests.post(\n    'http://localhost:3003/chat/message',\n    json={\n        'message': '¿Cuáles son sus horarios?',\n        'sessionId': 'test-session'\n    },\n    headers={'x-user-id': 'user-123'}\n)\n\nprint(response.json())\n\n# Obtener analytics\nanalytics = requests.get(\n    'http://localhost:3003/analytics',\n    headers={'x-user-id': 'user-123'}\n)\n\nprint(analytics.json())\n```\n\n## 🛡️ **Seguridad y Validación**\n\n### **Validaciones de entrada:**\n- ✅ **Mensaje**: 1-256 caracteres\n- ✅ **SessionId**: String opcional\n- ✅ **Headers**: Sanitización automática\n- ✅ **XSS Protection**: Filtrado de scripts\n\n### **Rate Limiting:**\n- 🔄 **En desarrollo**: Sin límites\n- 🚀 **En producción**: 100 requests/minuto por IP\n\n### **CORS:**\n```javascript\n// Configuración actual\napp.enableCors({\n  origin: ['http://localhost:3000', 'http://localhost:3001'],\n  credentials: true,\n});\n```\n\n## 🐛 **Debugging y Logs**\n\n### **Logs del sistema:**\n```bash\n# Ver logs en tiempo real\nnpm run start:dev\n\n# Logs con nivel debug\nDEBUG=* npm run start:dev\n```\n\n### **Endpoints de health check:**\n```\nGET /health\nGET /metrics\n```\n\n## 📋 **Testing de la API**\n\n### **Postman Collection**\nImporta la colección de Postman desde el archivo `postman_collection.json` (si está disponible)\n\n### **Swagger Testing**\n1. Ve a http://localhost:3003/api/docs\n2. Expande cualquier endpoint\n3. Haz clic en \"Try it out\"\n4. Llena los parámetros\n5. Ejecuta la petición\n\n## 🚀 **Despliegue**\n\n### **Variables de entorno requeridas:**\n```env\nPORT=3003\nDATABASE_URL=\"postgresql://...\"\nGOOGLE_APPLICATION_CREDENTIALS=\"path/to/credentials.json\"\nOPENAI_API_KEY=\"sk-...\"\n```\n\n### **Docker:**\n```bash\ndocker build -t chatbot-service .\ndocker run -p 3003:3003 chatbot-service\n```\n\n## 📞 **Soporte**\n\nPara más información o soporte:\n- 📧 **Email**: soporte@empresa.com\n- 📱 **Slack**: #chatbot-support\n- 🐛 **Issues**: GitHub Issues\n\n---\n\n**✨ ¡La documentación Swagger interactiva está disponible en http://localhost:3003/api/docs! ✨**\n