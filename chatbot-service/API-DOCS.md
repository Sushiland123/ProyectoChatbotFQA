# ğŸ“š DocumentaciÃ³n API - Chatbot Service\n\n## ğŸš€ **Acceso a la DocumentaciÃ³n**\n\n### ğŸ“– **Swagger UI (Interactiva)**\n```\nhttp://localhost:3003/api/docs\n```\n\n### ğŸ”— **Endpoint de la API**\n```\nhttp://localhost:3003\n```\n\n## ğŸ¯ **Endpoints Principales**\n\n### ğŸ¤– **Chat**\n\n#### **POST /chat/message**\n- **DescripciÃ³n**: Endpoint principal para enviar mensajes al chatbot\n- **AutenticaciÃ³n**: No requerida\n- **Headers opcionales**:\n  - `x-user-id`: ID del usuario para contexto\n\n**Ejemplo de peticiÃ³n:**\n```json\n{\n  \"message\": \"Â¿CuÃ¡les son sus horarios de atenciÃ³n?\",\n  \"sessionId\": \"user-session-123\"\n}\n```\n\n**Ejemplo de respuesta:**\n```json\n{\n  \"message\": \"Nuestros horarios son de lunes a viernes de 8:00 AM a 6:00 PM\",\n  \"sessionId\": \"user-session-123\",\n  \"origen\": \"DIALOGFLOW\",\n  \"escalado\": false,\n  \"timestamp\": \"2024-01-15T10:30:00Z\"\n}\n```\n\n#### **GET /chat** (Legacy)\n- **DescripciÃ³n**: Endpoint de compatibilidad con versiones anteriores\n- **ParÃ¡metros**:\n  - `q`: Mensaje del usuario\n  - `session`: ID de sesiÃ³n (opcional)\n\n**Ejemplo:**\n```\nGET /chat?q=Â¿CuÃ¡les son sus horarios?&session=user-123\n```\n\n### ğŸ“Š **Analytics**\n\n#### **GET /analytics**\n- **DescripciÃ³n**: Obtener mÃ©tricas y estadÃ­sticas del chatbot\n- **Headers opcionales**:\n  - `x-user-id`: Filtrar por usuario especÃ­fico\n\n**Ejemplo de respuesta:**\n```json\n{\n  \"interacciones\": {\n    \"total\": 1250,\n    \"hoy\": 45,\n    \"semana\": 312,\n    \"mes\": 1250\n  },\n  \"origen\": {\n    \"dialogflow\": 875,\n    \"ia\": 375\n  },\n  \"escalamiento\": {\n    \"total\": 25,\n    \"porcentaje\": 2.0\n  },\n  \"sesionesUnicas\": 450,\n  \"tiempoPromedioRespuesta\": 245\n}\n```\n\n## ğŸ”„ **Flujo de ConversaciÃ³n**\n\n### 1. **Consulta Simple**\n```\nğŸ‘¤ Usuario: \"Â¿CuÃ¡les son sus horarios?\"\nğŸ¤– Dialogflow: \"Nuestros horarios son de 8 AM a 6 PM\"\nâœ… Origen: DIALOGFLOW\n```\n\n### 2. **Consulta Compleja (Fallback a IA)**\n```\nğŸ‘¤ Usuario: \"ExplÃ­came sobre inteligencia artificial\"\nâŒ Dialogflow: No entiende\nğŸ¤– OpenAI: \"La inteligencia artificial es...\"\nâœ… Origen: IA\n```\n\n### 3. **Escalamiento a Soporte**\n```\nğŸ‘¤ Usuario: \"no entiendo, esto no me ayuda\"\nğŸ¤– Sistema: \"Â¿Desea escalar a soporte? EnvÃ­e DUI y correo\"\nğŸ‘¤ Usuario: \"12345678-9 user@email.com\"\nğŸ¤– Sistema: \"âœ… Ticket #123 creado\"\nâœ… Escalado: true\n```\n\n## ğŸ”§ **CÃ³digos de Estado HTTP**\n\n| CÃ³digo | DescripciÃ³n | Casos |\n|--------|-------------|-------|\n| **200** | OK | GET /chat, GET /analytics |\n| **201** | Created | POST /chat/message |\n| **400** | Bad Request | Mensaje vacÃ­o, formato invÃ¡lido |\n| **500** | Internal Error | Error en servicios externos |\n\n## ğŸ“ **Ejemplos de Uso**\n\n### **cURL**\n\n```bash\n# Enviar mensaje simple\ncurl -X POST http://localhost:3003/chat/message \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"message\": \"Â¿CuÃ¡les son sus horarios?\",\n    \"sessionId\": \"test-session\"\n  }'\n\n# Obtener analytics\ncurl -X GET http://localhost:3003/analytics \\\n  -H \"x-user-id: user-123\"\n```\n\n### **JavaScript/Fetch**\n\n```javascript\n// Enviar mensaje\nconst response = await fetch('http://localhost:3003/chat/message', {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/json',\n    'x-user-id': 'user-123'\n  },\n  body: JSON.stringify({\n    message: 'Â¿CuÃ¡les son sus horarios?',\n    sessionId: 'user-session-123'\n  })\n});\n\nconst data = await response.json();\nconsole.log(data);\n\n// Obtener analytics\nconst analytics = await fetch('http://localhost:3003/analytics', {\n  headers: {\n    'x-user-id': 'user-123'\n  }\n});\n\nconst metrics = await analytics.json();\nconsole.log(metrics);\n```\n\n### **Python/Requests**\n\n```python\nimport requests\n\n# Enviar mensaje\nresponse = requests.post(\n    'http://localhost:3003/chat/message',\n    json={\n        'message': 'Â¿CuÃ¡les son sus horarios?',\n        'sessionId': 'test-session'\n    },\n    headers={'x-user-id': 'user-123'}\n)\n\nprint(response.json())\n\n# Obtener analytics\nanalytics = requests.get(\n    'http://localhost:3003/analytics',\n    headers={'x-user-id': 'user-123'}\n)\n\nprint(analytics.json())\n```\n\n## ğŸ›¡ï¸ **Seguridad y ValidaciÃ³n**\n\n### **Validaciones de entrada:**\n- âœ… **Mensaje**: 1-256 caracteres\n- âœ… **SessionId**: String opcional\n- âœ… **Headers**: SanitizaciÃ³n automÃ¡tica\n- âœ… **XSS Protection**: Filtrado de scripts\n\n### **Rate Limiting:**\n- ğŸ”„ **En desarrollo**: Sin lÃ­mites\n- ğŸš€ **En producciÃ³n**: 100 requests/minuto por IP\n\n### **CORS:**\n```javascript\n// ConfiguraciÃ³n actual\napp.enableCors({\n  origin: ['http://localhost:3000', 'http://localhost:3001'],\n  credentials: true,\n});\n```\n\n## ğŸ› **Debugging y Logs**\n\n### **Logs del sistema:**\n```bash\n# Ver logs en tiempo real\nnpm run start:dev\n\n# Logs con nivel debug\nDEBUG=* npm run start:dev\n```\n\n### **Endpoints de health check:**\n```\nGET /health\nGET /metrics\n```\n\n## ğŸ“‹ **Testing de la API**\n\n### **Postman Collection**\nImporta la colecciÃ³n de Postman desde el archivo `postman_collection.json` (si estÃ¡ disponible)\n\n### **Swagger Testing**\n1. Ve a http://localhost:3003/api/docs\n2. Expande cualquier endpoint\n3. Haz clic en \"Try it out\"\n4. Llena los parÃ¡metros\n5. Ejecuta la peticiÃ³n\n\n## ğŸš€ **Despliegue**\n\n### **Variables de entorno requeridas:**\n```env\nPORT=3003\nDATABASE_URL=\"postgresql://...\"\nGOOGLE_APPLICATION_CREDENTIALS=\"path/to/credentials.json\"\nOPENAI_API_KEY=\"sk-...\"\n```\n\n### **Docker:**\n```bash\ndocker build -t chatbot-service .\ndocker run -p 3003:3003 chatbot-service\n```\n\n## ğŸ“ **Soporte**\n\nPara mÃ¡s informaciÃ³n o soporte:\n- ğŸ“§ **Email**: soporte@empresa.com\n- ğŸ“± **Slack**: #chatbot-support\n- ğŸ› **Issues**: GitHub Issues\n\n---\n\n**âœ¨ Â¡La documentaciÃ³n Swagger interactiva estÃ¡ disponible en http://localhost:3003/api/docs! âœ¨**\n